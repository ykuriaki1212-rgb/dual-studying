# スタディダッシュボード セットアップガイド（エラー解決版）

## ⚠️ 重要な変更点

前回のバージョンで発生していた **権限エラーを解決** しました。  
新しいバージョンでは `SPREADSHEET_ID` の設定が不要になりました！

## 🚀 セットアップ手順（修正版）

### Step 1: スプレッドシートの作成

1. **Google Driveにアクセス**
   - https://drive.google.com にアクセス

2. **新規スプレッドシートを作成**
   - 「新規」→「Googleスプレッドシート」→「空白のスプレッドシート」

3. **スプレッドシート名を変更**
   - 左上のタイトルを「**ダブル受験進捗記録簿**」に変更

### Step 2: Apps Scriptの設定

1. **スプレッドシートから直接Apps Scriptを開く**（重要！）
   - スプレッドシートで「**拡張機能**」→「**Apps Script**」をクリック
   - 新しいタブでApps Scriptエディタが開きます

2. **既存のコードを削除**
   - エディタに表示されている既存のコード（`function myFunction() {`...）を全て削除

3. **新しいコードを貼り付け**
   - `google_apps_script_fixed.gs` の内容を全てコピー
   - Apps Scriptエディタに貼り付け

4. **保存**
   - `Ctrl + S`（Mac: `Cmd + S`）またはディスクアイコン（💾）をクリック
   - プロジェクト名を「ダブル受験ダッシュボードAPI」などに変更（任意）

### Step 3: 初回認証と初期化

1. **関数を選択**
   - 画面上部の関数セレクタ（プルダウンメニュー）で「**testInit**」を選択
   ```
   [testInit ▼]  ▶実行  デバッグ
   ```

2. **実行ボタンをクリック**
   - 「▶実行」ボタンをクリック

3. **初回認証（重要！）**
   - 「承認が必要です」というダイアログが表示されます
   - 「**権限を確認**」をクリック
   
   ![認証画面](認証が必要)

4. **アカウント選択**
   - 使用するGoogleアカウントを選択

5. **安全性の警告が表示される場合**
   - 「**詳細**」をクリック
   - 「**（プロジェクト名）に移動**」をクリック
   - 「**許可**」をクリック

6. **実行ログを確認**
   - 画面下部の「**実行ログ**」タブをクリック
   - 以下のようなメッセージが表示されればOK：
   ```
   === 初期化開始 ===
   スプレッドシート名: ダブル受験進捗記録簿
   スプレッドシートID: 1ABcD2EfG...
   進捗データシート作成中...
   進捗データシート作成完了（37列）
   更新ログシート作成中...
   更新ログシート作成完了
   === ✅ 初期化が完了しました ===
   ```

7. **スプレッドシートを確認**
   - スプレッドシートのタブに戻る
   - 画面下部に「**進捗データ**」と「**更新ログ**」の2つのシートが作成されていることを確認

### Step 4: 書式設定（オプション）

見た目を整えたい場合は、以下を実行してください：

1. 関数セレクタで「**formatSheets**」を選択
2. 「▶実行」ボタンをクリック
3. ヘッダー行が青色・緑色に色付けされます

### Step 5: Webアプリとしてデプロイ

1. **デプロイを開始**
   - Apps Scriptエディタ右上の「**デプロイ**」→「**新しいデプロイ**」

2. **デプロイの種類を選択**
   - 左側の「種類の選択」（歯車アイコン⚙️）をクリック
   - 「**ウェブアプリ**」を選択

3. **デプロイの設定**
   - **説明**: 「初回デプロイ」など（任意）
   - **次のユーザーとして実行**: 「**自分**」を選択
   - **アクセスできるユーザー**: 「**全員**」を選択 ← **これが重要！**

4. **デプロイ実行**
   - 「**デプロイ**」ボタンをクリック
   - 再度認証を求められた場合は承認

5. **URLをコピー**
   - 「**ウェブアプリのURL**」が表示されます
   - URLを**全てコピー**してメモ帳などに保存
   - 例: `https://script.google.com/macros/s/AKfycbz.../exec`

### Step 6: HTMLファイルの設定

1. **dashboard.htmlをテキストエディタで開く**
   - メモ帳、Visual Studio Code、サクラエディタなど

2. **API URLを設定**
   - 56行目付近の以下の部分を探す：
   ```javascript
   const API_URL = 'https://script.google.com/macros/s/XXXXX/exec';
   ```
   
   - `XXXXX` の部分を、Step 5でコピーしたURLの該当部分に置き換え：
   ```javascript
   const API_URL = 'https://script.google.com/macros/s/AKfycbz.../exec';
   ```

3. **ファイルを保存**

### Step 7: 動作確認

1. **HTMLファイルをブラウザで開く**
   - `dashboard.html` をダブルクリック
   - またはブラウザにドラッグ&ドロップ

2. **同期ステータスを確認**
   - ページ右上に「**🟢 同期済み**」と表示されればOK！

3. **データ保存テスト**
   - 任意の科目の「**+**」ボタンをクリック
   - 数秒後に「🟢 同期済み」に戻ることを確認
   - スプレッドシートの「進捗データ」シートを開いて、数値が保存されているか確認

4. **マルチデバイステスト**
   - スマホやタブレットでも同じHTMLファイルを開く
   - 同じデータが表示されることを確認

## 🔧 よくあるエラーと解決方法

### エラー1: 「You do not have permission to call SpreadsheetApp.openById」

**原因**: 古いバージョンのコードを使用している

**解決策**:
- `google_apps_script_fixed.gs` の内容を使用してください
- `SPREADSHEET_ID` の設定は不要です
- スプレッドシートから直接「拡張機能」→「Apps Script」で開いてください

### エラー2: 「承認が必要です」が表示され続ける

**解決策**:
1. ブラウザのCookieを有効にする
2. シークレットモードを解除する
3. ポップアップブロックを無効にする

### エラー3: 「🔴 オフライン」と表示される

**原因1**: API URLが未設定または間違っている

**解決策**:
- `dashboard.html` の `API_URL` を確認
- `XXXXX` が残っていないか確認

**原因2**: デプロイ設定が間違っている

**解決策**:
- Apps Scriptで「デプロイ」→「デプロイを管理」
- 「アクセスできるユーザー」が「**全員**」になっているか確認
- 「自分」になっている場合は、右の歯車アイコンから編集して「全員」に変更

### エラー4: データが保存されない

**解決策**:
1. ブラウザのコンソールを開く（F12キー）
2. エラーメッセージを確認
3. スプレッドシートの「更新ログ」シートを確認

## 📝 確認用チェックリスト

- [ ] スプレッドシートの名前が「ダブル受験進捗記録簿」になっている
- [ ] スプレッドシート**から**「拡張機能」→「Apps Script」を開いた
- [ ] `google_apps_script_fixed.gs` のコードを貼り付けた（IDの設定は不要）
- [ ] `testInit` 関数を実行して認証を許可した
- [ ] 実行ログに「✅ 初期化が完了しました」と表示された
- [ ] 「進捗データ」と「更新ログ」の2つのシートが作成されている
- [ ] Webアプリとしてデプロイした（アクセス権限: 全員）
- [ ] デプロイURLをコピーした
- [ ] `dashboard.html` の `API_URL` にURLを貼り付けた
- [ ] ブラウザで開いて「🟢 同期済み」と表示される

## 🎯 成功の確認方法

以下の全てが実行できればセットアップ成功です：

1. ✅ HTMLを開くと「🟢 同期済み」と表示される
2. ✅ +/− ボタンを押すと約1秒後に自動保存される
3. ✅ スプレッドシートにデータが保存される
4. ✅ 別のデバイスで開いても同じデータが表示される
5. ✅ 「更新ログ」シートに操作履歴が記録される

## 📺 YouTubeチャンネル活用法

ダッシュボードの下部には、おすすめのYouTubeチャンネルへのリンクがあります：

**社労士試験**:
- アガルート、フォーサイト、資格の大原、LEC、たけださん

**行政書士試験**:
- ゆーき大学、アガルート、伊藤塾、資格スクエア、佐藤浩一先生

**活用のコツ**: 通勤時間は聞き流し、休日は1.5〜2倍速で視聴！

## 🆘 それでも解決しない場合

1. **ブラウザのコンソールを確認**
   - F12キーを押す
   - 「Console」タブでエラーメッセージを確認

2. **Apps Scriptの実行ログを確認**
   - Apps Scriptエディタの「実行数」メニューを確認

3. **testInit を再実行**
   - 既存のシートを削除して、もう一度 testInit を実行

---

頑張ってください！🎓 社労士試験・行政書士試験のダブル合格を応援しています！
